<div id="user-profile-page">
    <h1>User Profile</h1>
    <div id="profile-details">
        <!-- Profile data will be populated here -->
    </div>
</div>

<script>
    import { UserProfileService } from './js/services/userProfileService.js';

    // Fetch user profile when the page loads
    window.onload = async () => {
        const userId = window.location.pathname.split('/')[2]; // Extract user ID from URL
        const currentUser = JSON.parse(localStorage.getItem('current_user')); // Assuming you store the current user in localStorage or session
        const profile = await UserProfileService.getUserProfile(userId); // Fetch profile based on ID

        if (profile) {
            let profileDetailsHTML = `
                <p>User: ${profile.userName}</p>
                <h3>Your Listings</h3>
                <div>${profile.listings.map(listing => `<p>${listing.name} - ${listing.description}</p>`).join('')}</div>
            `;

            // Check if the profile belongs to the current user
            if (currentUser && currentUser.id === profile.id) {
                profileDetailsHTML += `
                    <button id="edit-profile-btn">Edit Profile</button>
                `;
            }

            document.getElementById('profile-details').innerHTML = profileDetailsHTML;

            // Show the edit form when the "Edit Profile" button is clicked
            const editProfileBtn = document.getElementById('edit-profile-btn');
            if (editProfileBtn) {
                editProfileBtn.addEventListener('click', () => {
                    document.getElementById('profile-details').innerHTML = `
                        <h2>Edit Profile</h2>
                        <form id="edit-profile-form">
                            <label for="name">New Name:</label>
                            <input type="text" id="name" name="name" value="${profile.userName}" required>
                            <button type="submit">Save</button>
                        </form>
                    `;
                    // Handle form submission
                    document.getElementById('edit-profile-form').addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const newName = document.getElementById('name').value;
                        const updatedProfile = await UserProfileService.updateUserName(profile.id, newName);

                        if (updatedProfile) {
                            alert('Profile updated successfully!');
                            // Optionally, reload the profile to show the updated name
                            window.location.reload();
                        } else {
                            alert('Error updating profile.');
                        }
                    });
                });
            }
        } else {
            document.getElementById('profile-details').innerHTML = '<p>Profile not found.</p>';
        }
    };
</script>
